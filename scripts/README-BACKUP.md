# üóÑÔ∏è –°–∏—Å—Ç–µ–º–∞ –±—ç–∫–∞–ø–æ–≤ Naken Store

–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –±—ç–∫–∞–ø—ã —Ç–≤–æ–µ–≥–æ —Å–∞–π—Ç–∞, –≤–∫–ª—é—á–∞—è –∫–æ–¥, –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.

## üìÅ –§–∞–π–ª—ã

- `backup.sh` - –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–æ–≤
- `setup-backup-cron.sh` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
- `README-BACKUP.md` - –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –†–∞–∑–æ–≤—ã–π –±—ç–∫–∞–ø (–≤—Ä—É—á–Ω—É—é)

```bash
# –ü–µ—Ä–µ–π–¥–∏ –≤ –ø–∞–ø–∫—É —Å –ø—Ä–æ–µ–∫—Ç–æ–º
cd /path/to/your/naken-project

# –ó–∞–ø—É—Å—Ç–∏ –±—ç–∫–∞–ø
./scripts/backup.sh
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤

```bash
# –ù–∞—Å—Ç—Ä–æ–π –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã –≤ 2:00 —É—Ç—Ä–∞
./scripts/setup-backup-cron.sh
```

## üìã –ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –±—ç–∫–∞–ø

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–ª–Ω—ã–π –¥–∞–º–ø PostgreSQL –≤ –¥–≤—É—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö:
  - `.sql` - —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (—á–∏—Ç–∞–µ–º—ã–π)
  - `.sql.custom` - –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–¥–ª—è pg_restore)

### üíæ –§–∞–π–ª—ã
- –í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (`public/uploads/`)
- –ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã (`public/media/`)

### üìù –ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
- –í–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (–±–µ–∑ `node_modules`, `.next`, `.git`)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (`.env`, `ecosystem.config.js`)
- –§–∞–π–ª —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤–µ—Ä—Å–∏–∏ Git

### üìä –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
- –í–µ—Ä—Å–∏—è Git –∏ –≤–µ—Ç–∫–∞
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏):

```bash
DB_NAME=naken_store    # –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
DB_USER=postgres       # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
DB_HOST=localhost      # –•–æ—Å—Ç –ë–î
DB_PORT=5432          # –ü–æ—Ä—Ç –ë–î
DB_PASSWORD=          # –ü–∞—Ä–æ–ª—å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!)
```

### –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –±—ç–∫–∞–ø—ã

```bash
/backups/naken_full_backup_YYYYMMDD_HHMMSS.tar.gz
```

## üîß –ö–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—ç–∫–∞–ø

### 1. –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤
```bash
cd /backups
tar -xzf naken_full_backup_20241205_020000.tar.gz
cd naken_backup_20241205_020000
```

### 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–¥
```bash
tar -xf code/project_code.tar
cp code/.env.backup /path/to/project/.env
```

### 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–æ–∑–¥–∞–π –Ω–æ–≤—É—é –±–∞–∑—É
createdb new_naken_store

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏ –¥–∞–Ω–Ω—ã–µ
pg_restore -d new_naken_store database/naken_*.sql.custom
```

### 4. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã
```bash
cp -r files/uploads/ /path/to/project/public/
cp -r files/media/ /path/to/project/public/
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
```bash
cd /path/to/project
npm install
npm run build
pm2 restart all
```

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞–º–∏

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –±—ç–∫–∞–ø—ã
```bash
ls -la /backups/
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
```bash
tail -f /var/log/naken-backup.log
```

### –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
```bash
crontab -e
# –ò–∑–º–µ–Ω–∏ –≤—Ä–µ–º—è –≤ —Å—Ç—Ä–æ–∫–µ —Å backup.sh
```

### –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
```bash
crontab -e
# –£–¥–∞–ª–∏ –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —Å—Ç—Ä–æ–∫—É —Å backup.sh
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞: "pg_dump –Ω–µ –Ω–∞–π–¥–µ–Ω"
```bash
# Ubuntu/Debian
sudo apt-get install postgresql-client

# CentOS/RHEL
sudo yum install postgresql
```

### –û—à–∏–±–∫–∞: "Permission denied –Ω–∞ /backups"
```bash
sudo mkdir -p /backups
sudo chown $(whoami):$(whoami) /backups
```

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
–ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
echo $DB_PASSWORD
echo $DB_NAME
```

### –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–∞
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –±—ç–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞:
```bash
# –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
find /backups -name "naken_full_backup_*.tar.gz" -mtime +7 -delete
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ë—ç–∫–∞–ø—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ `600` (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü)
- –ü–∞—Ä–æ–ª–∏ –ë–î –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–æ–≥–∞—Ö
- –ê—Ä—Ö–∏–≤—ã —Å–∂–∏–º–∞—é—Ç—Å—è –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞
```bash
tail -20 /var/log/naken-backup.log | grep -E "(—É—Å–ø–µ—à–Ω–æ|ERROR)"
```

### –†–∞–∑–º–µ—Ä –≤—Å–µ—Ö –±—ç–∫–∞–ø–æ–≤
```bash
du -sh /backups/
```

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ cron
```bash
crontab -l | grep backup
```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–¢–µ—Å—Ç–∏—Ä—É–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–π, —á—Ç–æ –±—ç–∫–∞–ø—ã –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
2. **–°–ª–µ–¥–∏ –∑–∞ –º–µ—Å—Ç–æ–º** - —É–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è –±—ç–∫–∞–ø–æ–≤
3. **–ö–æ–ø–∏—Ä—É–π –≤ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ** - –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–ø–∏—Ä—É–π –±—ç–∫–∞–ø—ã –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –Ω–∞—Å—Ç—Ä–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –±—ç–∫–∞–ø–∞ –ø–æ email

## üìû –ü–æ–º–æ—â—å

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `tail -f /var/log/naken-backup.log`
2. –ó–∞–ø—É—Å—Ç–∏ –±—ç–∫–∞–ø –≤—Ä—É—á–Ω—É—é: `./scripts/backup.sh`
3. –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–∞–º –∏ —Ñ–∞–π–ª–∞–º
4. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã 